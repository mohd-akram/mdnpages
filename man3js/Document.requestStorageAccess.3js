.\" Automatically generated by Pandoc 3.6.2
.\"
.TH "Document.requestStorageAccess" "JS" "February 21, 2025" "JavaScript" "JavaScript Reference Manual"
.SH NAME
Document.requestStorageAccess \- Document: requestStorageAccess() method
.SH SYNOPSIS
The \f[B]\f[CB]requestStorageAccess()\f[B]\f[R] method of the
\f[CR]Document\f[R] interface allows content loaded in a third\-party
context (i.e., embedded in an \f[CR]<iframe>\f[R]) to request access to
third\-party cookies and unpartitioned state.
This is relevant to user agents that, by default, block access to
third\-party, unpartitioned cookies to improve privacy (e.g., to prevent
tracking), and is part of the Storage Access API.
.PP
To check whether permission to access third\-party cookies has already
been granted, you can call \f[CR]Permissions.query()\f[R], specifying
the feature name \f[CR]\[dq]storage\-access\[dq]\f[R].
.RS
.PP
\f[B]Note:\f[R] Usage of this feature may be blocked by a
\f[CR]storage\-access\f[R] Permissions Policy set on your server.
In addition, the document must pass additional browser\-specific checks
such as allowlists, blocklists, on\-device classification, user
settings, anti\-clickjacking heuristics, or prompting the user for
explicit permission.
.RE
.SH SYNTAX
.IP
.EX
requestStorageAccess()
requestStorageAccess(types)
.EE
.SS Parameters
.TP
\f[B]types\f[R] \f[I](optional)\f[R]
An object containing properties that control what unpartitioned state is
made accessible.
If not specified, the default value of the property is \f[CR]false\f[R].
Available properties are as follows:
.RS
.TP
\f[B]all\f[R]
A boolean specifying all possible unpartitioned states should be made
accessible.
.TP
\f[B]cookies\f[R]
A boolean specifying third\-party cookies should be made accessible.
.TP
\f[B]sessionStorage\f[R]
A boolean specifying \f[CR]StorageAccessHandle.sessionStorage\f[R]
should be made accessible.
.TP
\f[B]localStorage\f[R]
A boolean specifying \f[CR]StorageAccessHandle.localStorage\f[R] should
be made accessible.
.TP
\f[B]indexedDB\f[R]
A boolean specifying \f[CR]StorageAccessHandle.indexedDB\f[R] should be
made accessible.
.TP
\f[B]locks\f[R]
A boolean specifying \f[CR]StorageAccessHandle.locks\f[R] should be made
accessible.
.TP
\f[B]caches\f[R]
A boolean specifying \f[CR]StorageAccessHandle.caches\f[R] should be
made accessible.
.TP
\f[B]getDirectory\f[R]
A boolean specifying \f[CR]StorageAccessHandle.getDirectory()\f[R]
should be made accessible.
.TP
\f[B]estimate\f[R]
A boolean specifying \f[CR]StorageAccessHandle.estimate()\f[R] should be
made accessible.
.TP
\f[B]createObjectURL\f[R]
A boolean specifying \f[CR]StorageAccessHandle.createObjectURL()\f[R]
should be made accessible.
.TP
\f[B]revokeObjectURL\f[R]
A boolean specifying \f[CR]StorageAccessHandle.revokeObjectURL()\f[R]
should be made accessible.
.TP
\f[B]BroadcastChannel\f[R]
A boolean specifying \f[CR]StorageAccessHandle.BroadcastChannel()\f[R]
should be made accessible.
.TP
\f[B]SharedWorker\f[R]
A boolean specifying \f[CR]StorageAccessHandle.SharedWorker()\f[R]
should be made accessible.
.RE
.SS Return value
A \f[CR]Promise\f[R] that fulfills with \f[CR]undefined\f[R] if the
access to third\-party cookies was granted and no \f[CR]types\f[R]
parameter was provided, fulfills with \f[CR]StorageAccessHandle\f[R] if
the access to unpartitioned state requested by the \f[CR]types\f[R]
parameter was provided, and rejects if access was denied.
.PP
\f[CR]requestStorageAccess()\f[R] requests are automatically denied
unless the embedded content is currently processing a user gesture such
as a tap or click (transient activation), or unless permission was
already granted previously.
If permission was not previously granted, they need to be run inside a
user gesture\-based event handler.
The user gesture behavior depends on the state of the promise:
.IP \[bu] 2
If the promise resolves (i.e.\ if permission was granted), then the user
gesture has not been consumed, so the script can subsequently call APIs
that require a user gesture.
.IP \[bu] 2
If the promise rejects (i.e.\ permission was not granted), then the user
gesture has been consumed, so the script can\[cq]t do anything that
requires a gesture.
This is intentional protection against abuse \[em] it prevents scripts
from calling \f[CR]requestStorageAccess()\f[R] in a loop until the user
accepts the prompt.
.SS Exceptions
.TP
\f[B]InvalidStateError\f[R] \f[B]DOMException\f[R]
Thrown if:
.RS
.IP \[bu] 2
The current \f[CR]Document\f[R] is not yet active.
.IP \[bu] 2
The \f[CR]types\f[R] parameter is provided and all of its properties are
\f[CR]false\f[R].
.RE
.TP
\f[B]NotAllowedError\f[R] \f[B]DOMException\f[R]
Thrown if:
.RS
.IP \[bu] 2
The document\[cq]s window is not a secure context.
.IP \[bu] 2
Usage is blocked by a \f[CR]storage\-access\f[R] Permissions Policy.
.IP \[bu] 2
The document or the top\-level document has a \f[CR]null\f[R] origin.
.IP \[bu] 2
The embedding \f[CR]<iframe>\f[R] is sandboxed, and the
\f[CR]allow\-storage\-access\-by\-user\-activation\f[R] token is not
set.
.IP \[bu] 2
Usage is denied by the user agent\[cq]s permission request to use the
API.
.RE
.SH EXAMPLES
.IP
.EX
document.requestStorageAccess().then(
  () \f[B]=>\f[R] {
    console.log(\[dq]cookie access granted\[dq]);
  },
  () \f[B]=>\f[R] {
    console.log(\[dq]cookie access denied\[dq]);
  },
);

document.requestStorageAccess({ localStorage: \f[B]true\f[R] }).then(
  (handle) \f[B]=>\f[R] {
    console.log(\[dq]localStorage access granted\[dq]);
    handle.localStorage.setItem(\[dq]foo\[dq], \[dq]bar\[dq]);
  },
  () \f[B]=>\f[R] {
    console.log(\[dq]localStorage access denied\[dq]);
  },
);
.EE
.RS
.PP
\f[B]Note:\f[R] See Using the Storage Access API for a more complete
example.
.RE
.SH SEE ALSO
.IP \[bu] 2
\f[CR]Document.hasStorageAccess()\f[R],
\f[CR]Document.hasUnpartitionedCookieAccess()\f[R],
\f[CR]Document.requestStorageAccessFor()\f[R]
.IP \[bu] 2
Using the Storage Access API
.IP \[bu] 2
\c
.UR https://webkit.org/blog/8124/introducing-storage-access-api/
Introducing Storage Access API
.UE \c
\ (WebKit blog)
