.\" Automatically generated by Pandoc 3.1.12.3
.\"
.TH "Document.requestStorageAccess" "JS" "December 20, 2023" "JavaScript" "JavaScript Reference Manual"
.SH NAME
Document.requestStorageAccess \- Document: requestStorageAccess() method
.SH SYNOPSIS
The \f[B]\f[CB]requestStorageAccess()\f[B]\f[R] method of the
\f[CR]Document\f[R] interface allows content loaded in a third\-party
context (i.e., embedded in an \f[CR]<iframe>\f[R]) to request access to
third\-party cookies.
This is relevant to user agents that, by default, block access to
third\-party, unpartitioned cookies to improve privacy (e.g., to prevent
tracking), and is part of the Storage Access API.
.PP
To check whether permission to access third\-party cookies has already
been granted, you can call \f[CR]Permissions.query()\f[R], specifying
the feature name \f[CR]\[dq]storage\-access\[dq]\f[R].
.RS
.PP
\f[B]Note:\f[R] Usage of this feature may be blocked by a
\f[CR]storage\-access\f[R] Permissions Policy set on your server.
In addition, the document must pass additional browser\-specific checks
such as allowlists, blocklists, on\-device classification, user
settings, anti\-clickjacking heuristics, or prompting the user for
explicit permission.
.RE
.SH SYNTAX
.IP
.EX
requestStorageAccess()
.EE
.SS Parameters
None.
.SS Return value
A \f[CR]Promise\f[R] that fulfills with \f[CR]undefined\f[R] if the
access to third\-party cookies was granted, and rejects if access was
denied.
.PP
\f[CR]requestStorageAccess()\f[R] requests are automatically denied
unless the embedded content is currently processing a user gesture such
as a tap or click (transient activation), or unless permission was
already granted previously.
If permission was not previously granted, they need to be run inside a
user gesture\-based event handler.
The user gesture behavior depends on the state of the promise:
.IP \[bu] 2
If the promise resolves (i.e.\ if permission was granted), then the user
gesture has not been consumed, so the script can subsequently call APIs
that require a user gesture.
.IP \[bu] 2
If the promise rejects (i.e.\ permission was not granted), then the user
gesture has been consumed, so the script can\[cq]t do anything that
requires a gesture.
This is intentional protection against abuse \[em] it prevents scripts
from calling \f[CR]requestStorageAccess()\f[R] in a loop until the user
accepts the prompt.
.SS Exceptions
.TP
\f[B]InvalidStateError\f[R] \f[B]DOMException\f[R]
Thrown if the current \f[CR]Document\f[R] is not yet active.
.TP
\f[B]NotAllowedError\f[R] \f[B]DOMException\f[R]
Thrown if:
.RS
.IP \[bu] 2
The document\[cq]s window is not a secure context.
.IP \[bu] 2
Usage is blocked by a \f[CR]storage\-access\f[R] Permissions Policy.
.IP \[bu] 2
The document or the top\-level document has a \f[CR]null\f[R] origin.
.IP \[bu] 2
The embedding \f[CR]<iframe>\f[R] is sandboxed, and the
\f[CR]allow\-storage\-access\-by\-user\-activation\f[R] token is not
set.
.IP \[bu] 2
Usage is denied by the user agent\[cq]s permission request to use the
API.
.RE
.SH EXAMPLES
.IP
.EX
document.requestStorageAccess().then(
  () \f[B]=>\f[R] {
    console.log(\[dq]access granted\[dq]);
  },
  () \f[B]=>\f[R] {
    console.log(\[dq]access denied\[dq]);
  },
);
.EE
.RS
.PP
\f[B]Note:\f[R] See Using the Storage Access API for a more complete
example.
.RE
.SH SEE ALSO
.IP \[bu] 2
\f[CR]Document.hasStorageAccess()\f[R],
\f[CR]Document.requestStorageAccessFor()\f[R]
.IP \[bu] 2
Using the Storage Access API
.IP \[bu] 2
\c
.UR https://webkit.org/blog/8124/introducing-storage-access-api/
Introducing Storage Access API
.UE \c
\ (WebKit blog)
