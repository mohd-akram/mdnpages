.\" Automatically generated by Pandoc 3.1.11
.\"
.TH "IDBObjectStore.add" "JS" "May 24, 2023" "JavaScript" "JavaScript Reference Manual"
.SH NAME
IDBObjectStore.add \- IDBObjectStore: add() method
.SH SYNOPSIS
The \f[B]\f[CB]add()\f[B]\f[R] method of the \f[CR]IDBObjectStore\f[R]
interface returns an \f[CR]IDBRequest\f[R] object, and, in a separate
thread, creates a \c
.UR
https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#structured-clone
structured clone
.UE \c
\ of the value, and stores the cloned value in the object store.
This is for adding new records to an object store.
.PP
To determine if the add operation has completed successfully, listen for
the transaction\[cq]s \f[CR]complete\f[R] event in addition to the
\f[CR]IDBObjectStore.add\f[R] request\[cq]s \f[CR]success\f[R] event,
because the transaction may still fail after the success event fires.
In other words, the success event is only triggered when the transaction
has been successfully queued.
.PP
The add method is an \f[I]insert only\f[R] method.
If a record already exists in the object store with the \f[CR]key\f[R]
parameter as its key, then an error \f[CR]ConstraintError\f[R] event is
fired on the returned request object.
For updating existing records, you should use the
\f[CR]IDBObjectStore.put\f[R] method instead.
.PP
This feature is available in Web Workers.
.SH SYNTAX
.IP
.EX
add(value)
add(value, key)
.EE
.SS Parameters
.TP
\f[B]value\f[R]
The value to be stored.
.TP
\f[B]key\f[R] \f[I](optional)\f[R]
The key to use to identify the record.
If unspecified, it results to null.
.SS Return value
An \f[CR]IDBRequest\f[R] object on which subsequent events related to
this operation are fired.
.PP
If the operation is successful, the value of the request\[cq]s
\f[CR]result\f[R] property is the key for the new record.
.SS Exceptions
This method may raise a \f[CR]DOMException\f[R] of one of the following
types:
.TP
\f[B]ReadOnlyError\f[R] \f[B]DOMException\f[R]
Thrown if the transaction associated with this operation is in
read\-only mode.
.TP
\f[B]TransactionInactiveError\f[R] \f[B]DOMException\f[R]
Thrown if this \f[CR]IDBObjectStore\f[R]\[cq]s transaction is inactive.
.TP
\f[B]DataError\f[R] \f[B]DOMException\f[R]
Thrown if any of the following conditions apply:
.RS
.IP \[bu] 2
The object store uses in\-line keys or has a key generator, and a key
parameter was provided.
.IP \[bu] 2
The object store uses out\-of\-line keys and has no key generator, and
no key parameter was provided.
.IP \[bu] 2
The object store uses in\-line keys but no key generator, and the object
store\[cq]s key path does not yield a valid key.
.IP \[bu] 2
The key parameter was provided but does not contain a valid key.
.RE
.TP
\f[B]InvalidStateError\f[R] \f[B]DOMException\f[R]
Thrown if the \f[CR]IDBObjectStore\f[R] has been deleted or removed.
.TP
\f[B]DataCloneError\f[R] \f[B]DOMException\f[R]
Thrown if the data being stored could not be cloned by the internal
structured cloning algorithm.
.TP
\f[B]ConstraintError\f[R] \f[B]DOMException\f[R]
Thrown if an insert operation failed because the primary key constraint
was violated (due to an already existing record with the same primary
key value).
.SH EXAMPLES
In the following code snippet, we open a read/write transaction on our
database and add some data to an object store using \f[CR]add()\f[R].
Note also the functions attached to transaction event handlers to report
on the outcome of the transaction opening in the event of success or
failure.
For a full working example, see our \c
.UR https://github.com/mdn/dom-examples/tree/main/to-do-notifications
To\-do Notifications
.UE \c
\ app (\c
.UR https://mdn.github.io/dom-examples/to-do-notifications/
view example live
.UE \c
).
.IP
.EX
// Let us open our database
const DBOpenRequest = window.indexedDB.open(\[dq]toDoList\[dq], 4);

DBOpenRequest.onsuccess = (event) => {
  note.innerHTML += \[dq]<li>Database initialized.</li>\[dq];

  // store the result of opening the database in the db variable.
  // This is used a lot below
  db = DBOpenRequest.result;

  // Run the addData() function to add the data to the database
  addData();
};

function addData() {
  // Create a new object ready to insert into the IDB
  const newItem = [
    {
      taskTitle: \[dq]Walk dog\[dq],
      hours: 19,
      minutes: 30,
      day: 24,
      month: \[dq]December\[dq],
      year: 2013,
      notified: \[dq]no\[dq],
    },
  ];

  // open a read/write db transaction, ready for adding the data
  const transaction = db.transaction([\[dq]toDoList\[dq]], \[dq]readwrite\[dq]);

  // report on the success of the transaction completing, when everything is done
  transaction.oncomplete = (event) => {
    note.innerHTML += \[dq]<li>Transaction completed.</li>\[dq];
  };

  transaction.onerror = (event) => {
    note.innerHTML +=
      \[dq]<li>Transaction not opened due to error. Duplicate items not allowed.</li>\[dq];
  };

  // create an object store on the transaction
  const objectStore = transaction.objectStore(\[dq]toDoList\[dq]);

  // Make a request to add our newItem object to the object store
  const objectStoreRequest = objectStore.add(newItem[0]);

  objectStoreRequest.onsuccess = (event) => {
    // report the success of our request
    note.innerHTML += \[dq]<li>Request successful.</li>\[dq];
  };
}
.EE
.SH SEE ALSO
.IP \[bu] 2
Using IndexedDB
.IP \[bu] 2
Starting transactions: \f[CR]IDBDatabase\f[R]
.IP \[bu] 2
Using transactions: \f[CR]IDBTransaction\f[R]
.IP \[bu] 2
Setting a range of keys: \f[CR]IDBKeyRange\f[R]
.IP \[bu] 2
Retrieving and making changes to your data: \f[CR]IDBObjectStore\f[R]
.IP \[bu] 2
Using cursors: \f[CR]IDBCursor\f[R]
.IP \[bu] 2
Reference example: \c
.UR https://github.com/mdn/dom-examples/tree/main/to-do-notifications
To\-do Notifications
.UE \c
\ (\c
.UR https://mdn.github.io/dom-examples/to-do-notifications/
View the example live
.UE \c
).
