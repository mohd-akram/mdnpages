.\" Automatically generated by Pandoc 3.7.0.1
.\"
.TH "EXTENDABLEEVENT" "3JS" "July 26, 2024" "JavaScript" "JavaScript Reference Manual"
.SH NAME
ExtendableEvent \- ExtendableEvent
.SH SYNOPSIS
\f[B]Note:\f[R] This feature is only available in Service Workers.
.PP
The \f[B]\f[CB]ExtendableEvent\f[B]\f[R] interface extends the lifetime
of the \f[CR]install\f[R] and \f[CR]activate\f[R] events dispatched on
the global scope as part of the service worker lifecycle.
This ensures that any functional events (like \f[CR]FetchEvent\f[R]) are
not dispatched until it upgrades database schemas and deletes the
outdated cache entries.
.PP
If \f[CR]waitUntil()\f[R] is called outside of the
\f[CR]ExtendableEvent\f[R] handler, the browser should throw an
\f[CR]InvalidStateError\f[R]; note also that multiple calls will stack
up, and the resulting promises will be added to the list of \c
.UR https://w3c.github.io/ServiceWorker/#extendableevent-extend-lifetime-promises
extend lifetime promises
.UE \c
\&.
.PP
This interface inherits from the \f[CR]Event\f[R] interface.
.RS
.PP
\f[B]Note:\f[R] This interface is only available when the global scope
is a \f[CR]ServiceWorkerGlobalScope\f[R].
It is not available when it is a \f[CR]Window\f[R], or the scope of
another kind of worker.
.RE
.SH CONSTRUCTOR
.TP
\f[B]ExtendableEvent()\f[R]
Creates a new \f[CR]ExtendableEvent\f[R] object.
.SH INSTANCE PROPERTIES
\f[I]Doesn\(cqt implement any specific properties, but inherits
properties from its parent, \f[CI]Event\f[I].\f[R]
.SH INSTANCE METHODS
\f[I]Inherits methods from its parent, \f[CI]Event\f[I]\f[R].
.TP
\f[B]ExtendableEvent.waitUntil()\f[R]
Extends the lifetime of the event.
It is intended to be called in the \f[CR]install\f[R] event handler for
the \f[CR]installing\f[R] worker and on the \f[CR]activate\f[R] event
handler for the \f[CR]active\f[R] worker.
.SH EXAMPLES
This code snippet is from the \c
.UR https://github.com/GoogleChrome/samples/blob/gh-pages/service-worker/prefetch/service-worker.js
service worker prefetch sample
.UE \c
\ (see \c
.UR https://googlechrome.github.io/samples/service-worker/prefetch/
prefetch example live
.UE \c
\&.)
The code calls \f[CR]ExtendableEvent.waitUntil()\f[R] in
\f[CR]oninstall\f[R], delaying treating the
\f[CR]ServiceWorkerRegistration.installing\f[R] worker as installed
until the passed promise resolves successfully.
The promise resolves when all resources have been fetched and cached, or
else when any exception occurs.
.PP
The code snippet also shows a best practice for versioning caches used
by the service worker.
Though there\(cqs only one cache in this example, the same approach can
be used for multiple caches.
It maps a shorthand identifier for a cache to a specific, versioned
cache name.
.RS
.PP
\f[B]Note:\f[R] In Chrome, logging statements are visible via the
\(lqInspect\(rq interface for the relevant service worker accessed via
chrome://serviceworker\-internals.
.RE
.IP
.EX
\f[B]const\f[R] CACHE_VERSION = 1;
\f[B]const\f[R] CURRENT_CACHES = {
  prefetch: \(gaprefetch\-cache\-v${CACHE_VERSION}\(ga,
};

self.addEventListener(\(dqinstall\(dq, (event) \f[B]=>\f[R] {
  \f[B]const\f[R] urlsToPrefetch = [
    \(dq./static/pre_fetched.txt\(dq,
    \(dq./static/pre_fetched.html\(dq,
    \(dqhttps://www.chromium.org/_/rsrc/1302286216006/config/customLogo.gif\(dq,
  ];

  console.log(
    \(dqHandling install event. Resources to pre\-fetch:\(dq,
    urlsToPrefetch,
  );

  event.waitUntil(
    caches
      .open(CURRENT_CACHES[\(dqprefetch\(dq])
      .then((cache) \f[B]=>\f[R] {
        \f[B]return\f[R] cache
          .addAll(
            urlsToPrefetch.map((urlToPrefetch) \f[B]=>\f[R] {
              \f[B]return\f[R] \f[B]new\f[R] Request(urlToPrefetch, { mode: \(dqno\-cors\(dq });
            }),
          )
          .then(() \f[B]=>\f[R] {
            console.log(\(dqAll resources have been fetched and cached.\(dq);
          });
      })
      .catch((error) \f[B]=>\f[R] {
        console.error(\(dqPre\-fetching failed:\(dq, error);
      }),
  );
});
.EE
.RS
.PP
\f[B]Note:\f[R] When fetching resources, it\(cqs very important to use
\f[CR]{mode: \(aqno\-cors\(aq}\f[R] if there is any chance that the
resources are served off of a server that doesn\(cqt support CORS.
In this example, \c
.UR https://www.chromium.org/
www.chromium.org
.UE \c
\ doesn\(cqt support CORS.
.RE
.SH SEE ALSO
.IP \(bu 2
Using Service Workers
.IP \(bu 2
\c
.UR https://github.com/mdn/dom-examples/tree/main/service-worker/simple-service-worker
Service workers basic code example
.UE \c
.IP \(bu 2
Using web workers
