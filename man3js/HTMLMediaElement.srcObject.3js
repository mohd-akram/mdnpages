.\" Automatically generated by Pandoc 3.1.12.3
.\"
.TH "HTMLMediaElement.srcObject" "JS" "August 25, 2023" "JavaScript" "JavaScript Reference Manual"
.SH NAME
HTMLMediaElement.srcObject \- HTMLMediaElement: srcObject property
.SH SYNOPSIS
The \f[B]\f[CB]srcObject\f[B]\f[R] property of the
\f[CR]HTMLMediaElement\f[R] interface sets or returns the object which
serves as the source of the media associated with the
\f[CR]HTMLMediaElement\f[R].
.PP
The object can be a \f[CR]MediaStream\f[R], a \f[CR]MediaSource\f[R], a
\f[CR]Blob\f[R], or a \f[CR]File\f[R] (which inherits from
\f[CR]Blob\f[R]).
.RS
.PP
\f[B]Note:\f[R] As of March 2020, only Safari has full support for
\f[CR]srcObject\f[R], i.e.\ using \f[CR]MediaSource\f[R],
\f[CR]MediaStream\f[R], \f[CR]Blob\f[R], and \f[CR]File\f[R] objects as
values.
Other browsers support \f[CR]MediaStream\f[R] objects; until they catch
up, consider falling back to creating a URL with
\f[CR]URL.createObjectURL()\f[R] and assigning it to
\f[CR]HTMLMediaElement.src\f[R] (see below for an example).
In addition, as of version 108 Chromium supports attaching a dedicated
worker \f[CR]MediaSource\f[R] object by assigning that object\[cq]s
\f[CR]MediaSourceHandle\f[R] instance (transferred from the worker) to
\f[CR]srcObject\f[R].
.RE
.SH VALUE
A \f[CR]MediaStream\f[R], \f[CR]MediaSource\f[R], \f[CR]Blob\f[R], or
\f[CR]File\f[R] object (though see the compatibility table for what is
actually supported).
.SH USAGE NOTES
Older versions of the Media Source specification required using
\f[CR]URL.createObjectURL()\f[R] to create an object URL then setting
\f[CR]src\f[R] to that URL.
Now you can just set \f[CR]srcObject\f[R] to the \f[CR]MediaStream\f[R]
directly.
.SH EXAMPLES
.SS Basic example
In this example, a \f[CR]MediaStream\f[R] from a camera is assigned to a
newly\-created \f[CR]<video>\f[R] element.
.IP
.EX
\f[B]const\f[R] mediaStream = \f[B]await\f[R] navigator.mediaDevices.getUserMedia({ video: \f[B]true\f[R] });
\f[B]const\f[R] video = document.createElement(\[dq]video\[dq]);
video.srcObject = mediaStream;
.EE
.PP
In this example, a new \f[CR]MediaSource\f[R] is assigned to a
newly\-created \f[CR]<video>\f[R] element.
.IP
.EX
\f[B]const\f[R] mediaSource = \f[B]new\f[R] MediaSource();
\f[B]const\f[R] video = document.createElement(\[dq]video\[dq]);
video.srcObject = mediaSource;
.EE
.SS Supporting fallback to the src property
The examples below support older browser versions that require you to
create an object URL and assign it to \f[CR]src\f[R] if
\f[CR]srcObject\f[R] isn\[cq]t supported.
.PP
First, a \f[CR]MediaStream\f[R] from a camera is assigned to a
newly\-created \f[CR]<video>\f[R] element, with fallback for older
browsers.
.IP
.EX
\f[B]const\f[R] mediaStream = \f[B]await\f[R] navigator.mediaDevices.getUserMedia({ video: \f[B]true\f[R] });
\f[B]const\f[R] video = document.createElement(\[dq]video\[dq]);
\f[B]if\f[R] (\[dq]srcObject\[dq] \f[B]in\f[R] video) {
  video.srcObject = mediaStream;
} \f[B]else\f[R] {
  \f[I]// Avoid using this in new browsers, as it is going away.\f[R]
  video.src = URL.createObjectURL(mediaStream);
}
.EE
.PP
Second, a new \f[CR]MediaSource\f[R] is assigned to a newly\-created
\f[CR]<video>\f[R] element, with fallback for older browsers and
browsers that don\[cq]t yet support assignment of \f[CR]MediaSource\f[R]
directly.
.IP
.EX
\f[B]const\f[R] mediaSource = \f[B]new\f[R] MediaSource();
\f[B]const\f[R] video = document.createElement(\[dq]video\[dq]);
\f[I]// Older browsers may not have srcObject\f[R]
\f[B]if\f[R] (\[dq]srcObject\[dq] \f[B]in\f[R] video) {
  \f[B]try\f[R] {
    video.srcObject = mediaSource;
  } \f[B]catch\f[R] (err) {
    \f[B]if\f[R] (err.name !== \[dq]TypeError\[dq]) {
      \f[B]throw\f[R] err;
    }
    \f[I]// Even if they do, they may only support MediaStream\f[R]
    video.src = URL.createObjectURL(mediaSource);
  }
} \f[B]else\f[R] {
  video.src = URL.createObjectURL(mediaSource);
}
.EE
.SS Constructing a \f[CR]MediaSource\f[R] in a worker and passing it to the main thread to play
The \f[CR]MediaSource.handle\f[R] property can be accessed inside a
dedicated worker and the resulting \f[CR]MediaSourceHandle\f[R] object
is then transferred over to the thread that created the worker (in this
case the main thread) via a \f[CR]postMessage()\f[R] call:
.IP
.EX
\f[I]// Inside dedicated worker\f[R]
\f[B]let\f[R] mediaSource = \f[B]new\f[R] MediaSource();
\f[B]let\f[R] handle = mediaSource.handle;
\f[I]// Transfer the handle to the context that created the worker\f[R]
postMessage({ arg: handle }, [handle]);

mediaSource.addEventListener(\[dq]sourceopen\[dq], () \f[B]=>\f[R] {
  \f[I]// Await sourceopen on MediaSource before creating SourceBuffers\f[R]
  \f[I]// and populating them with fetched media \[em] MediaSource won\[aq]t\f[R]
  \f[I]// accept creation of SourceBuffers until it is attached to the\f[R]
  \f[I]// HTMLMediaElement and its readyState is \[dq]open\[dq]\f[R]
});
.EE
.PP
Over in the main thread, we receive the handle via a \f[CR]message\f[R]
event handler, attach it to a \f[CR]<video>\f[R] via its
\f[CR]HTMLMediaElement.srcObject\f[R] property, and \f[CR]play\f[R] the
video:
.IP
.EX
worker.addEventListener(\[dq]message\[dq], (msg) \f[B]=>\f[R] {
  \f[B]let\f[R] mediaSourceHandle = msg.data.arg;
  video.srcObject = mediaSourceHandle;
  video.play();
});
.EE
.RS
.PP
\f[B]Note:\f[R] \f[CR]MediaSourceHandle\f[R]s cannot be successfully
transferred into or via a shared worker or service worker.
.RE
