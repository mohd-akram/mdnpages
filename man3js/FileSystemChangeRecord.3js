.\" Automatically generated by Pandoc 3.6.2
.\"
.TH "FileSystemChangeRecord" "JS" "March 3, 2025" "JavaScript" "JavaScript Reference Manual"
.SH NAME
FileSystemChangeRecord \- FileSystemChangeRecord
.SH SYNOPSIS
The \f[B]\f[CB]FileSystemChangeRecord\f[B]\f[R] dictionary of the File
System API contains details of a single change observed by a
\f[CR]FileSystemObserver\f[R].
.PP
The \f[CR]records\f[R] argument passed into the
\f[CR]FileSystemObserver()\f[R] constructor\[cq]s callback function is
an array of \f[CR]FileSystemChangeRecord\f[R] objects.
.SH INSTANCE PROPERTIES
.TP
\f[B]changedHandle\f[R]
A reference to the file system handle that the change was observed on.
.RS
.IP \[bu] 2
For the user\-observable file system, this can be a
\f[CR]FileSystemFileHandle\f[R] or a
\f[CR]FileSystemDirectoryHandle\f[R].
.IP \[bu] 2
For the Origin Private File System (OPFS), it can be a
\f[CR]FileSystemFileHandle\f[R], a \f[CR]FileSystemDirectoryHandle\f[R],
or a \f[CR]FileSystemSyncAccessHandle\f[R].
.PP
This property will be \f[CR]null\f[R] for records with a
\f[CR]\[dq]disappeared\[dq]\f[R], \f[CR]\[dq]errored\[dq]\f[R], or
\f[CR]\[dq]unknown\[dq]\f[R] type.
.RE
.TP
\f[B]relativePathComponents\f[R]
An array containing the path components that make up the relative file
path from the \f[CR]root\f[R] to the \f[CR]changedHandle\f[R], including
the \f[CR]changedHandle\f[R] filename.
.TP
\f[B]relativePathMovedFrom\f[R]
An array containing the path components that make up the relative file
path from the \f[CR]root\f[R] to the \f[CR]changedHandle\f[R]\[cq]s
former location, in the case of observations with a
\f[CR]\[dq]moved\[dq]\f[R] type.
If the type is not \f[CR]\[dq]moved\[dq]\f[R], this property will be
\f[CR]null\f[R].
.TP
\f[B]root\f[R]
A reference to the root file system handle, that is, the one passed to
the \f[CR]observe()\f[R] call that started the observation.
Again, this can be a \f[CR]FileSystemFileHandle\f[R],
\f[CR]FileSystemDirectoryHandle\f[R], or
\f[CR]FileSystemSyncAccessHandle\f[R].
.TP
\f[B]type\f[R]
A string representing the type of change that was observed.
Possible values are:
.RS
.TP
\f[B]appeared\f[R]
The file or directory was created or moved into the \f[CR]root\f[R] file
structure.
.TP
\f[B]disappeared\f[R]
The file or directory was deleted or moved out of the \f[CR]root\f[R]
file structure.
To find out which file or directory disappeared, you can query the
\f[CR]relativePathComponents\f[R] property.
.TP
\f[B]errored\f[R]
An error state occurred in the observed directory.
This can result when:
.RS
.IP \[bu] 2
The observation is no longer valid.
This can occur when the observed handle (that is, the \f[CR]root\f[R] of
the observation) is deleted or moved.
In this case, a \f[CR]\[dq]disappeared\[dq]\f[R] observation will be
recorded, followed by an \f[CR]\[dq]errored\[dq]\f[R] observation.
In such cases, you may wish to stop observing the file system using
\f[CR]FileSystemObserver.disconnect()\f[R].
.IP \[bu] 2
The maximum limit of per\-origin observations is reached.
This limit is dependent on the operating system and not known
beforehand.
If this happens, the site may decide to retry, though there\[cq]s no
guarantee that the operating system will have freed up enough resources.
.IP \[bu] 2
Permission to access the directory or file handle is removed.
.RE
.TP
\f[B]modified\f[R]
The file or directory was modified.
.TP
\f[B]moved\f[R]
The file or directory was moved within the root file structure.
> \f[B]Note:\f[R] > On Windows, \f[CR]\[dq]moved\[dq]\f[R] observations
aren\[cq]t supported between directories.
They are reported as a \f[CR]\[dq]disappeared\[dq]\f[R] observation in
the source directory and an \f[CR]\[dq]appeared\[dq]\f[R] observation in
the destination directory.
.TP
\f[B]unknown\f[R]
Indicates that some observations were missed.
If you wish to find out information on what changed in the missed
observations, you could fall back to polling the observed directory.
.RE
.PP
Depending on the operating system, not all observations will be reported
with the same level of detail, for example, when the contents of a
directory change recursively.
At best, the website will receive a detailed change record containing
the type of change and a handle to the affected path.
At worst, the website will receive a more generic change record (that
is, an \f[CR]\[dq]unknown\[dq]\f[R] type) that still requires it to
enumerate the directory to figure out which handle changed.
.PP
This is still an improvement over polling, since the directory
enumeration can be kicked off on\-demand from the callback function,
rather than needing to poll for changes periodically.
.SH EXAMPLES
.SS Initialize a \f[CR]FileSystemObserver\f[R]
Before you can start observing file or directory changes, you need to
initialize a \f[CR]FileSystemObserver\f[R] to handle the observations.
This is done using the \f[CR]FileSystemObserver()\f[R] constructor,
which takes a callback function as an argument:
.IP
.EX
\f[B]const\f[R] observer = \f[B]new\f[R] FileSystemObserver(callback);
.EE
.PP
The callback function body can be specified to return and process file
change observations in any way you want.
Each object inside the \f[CR]records\f[R] array is a
\f[CR]FileSystemChangeRecord\f[R] object:
.IP
.EX
\f[B]const\f[R] callback = (records, observer) \f[B]=>\f[R] {
  \f[B]for\f[R] (\f[B]const\f[R] record \f[B]of\f[R] records) {
    console.log(\[dq]Change detected:\[dq], record);
    \f[B]const\f[R] reportContent = \[ga]Change observed to ${record.changedHandle.kind} ${record.changedHandle.name}. Type: ${record.type}.\[ga];
    sendReport(reportContent); \f[I]// Some kind of user\-defined reporting function\f[R]
  }

  observer.disconnect();
};
.EE
