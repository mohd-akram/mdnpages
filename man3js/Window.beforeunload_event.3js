.\" Automatically generated by Pandoc 3.4
.\"
.TH "Window.beforeunload_event" "JS" "August 2, 2024" "JavaScript" "JavaScript Reference Manual"
.SH NAME
Window.beforeunload_event \- Window: beforeunload event
.SH SYNOPSIS
The \f[B]\f[CB]beforeunload\f[B]\f[R] event is fired when the current
window, contained document, and associated resources are about to be
unloaded.
The document is still visible and the event is still cancelable at this
point.
.PP
The main use case for this event is to trigger a browser\-generated
confirmation dialog that asks users to confirm if they \f[I]really\f[R]
want to leave the page when they try to close or reload it, or navigate
somewhere else.
This is intended to help prevent loss of unsaved data.
.PP
The dialog can be triggered in the following ways:
.IP \[bu] 2
Calling the event object\[cq]s \f[CR]preventDefault()\f[R] method.
.IP \[bu] 2
Setting the event object\[cq]s \f[CR]returnValue\f[R] property to a
non\-empty string value or any other truthy value.
.IP \[bu] 2
Returning any truthy value from the event handler function,
e.g.\ \f[CR]return \[dq]string\[dq]\f[R].
Note that this only works when the function is attached via the
\f[CR]onbeforeunload\f[R] property, not the
\f[CR]addEventListener()\f[R] method.
This behavior is consistent across modern versions of Firefox, Safari,
and Chrome.
.PP
The last two mechanisms are legacy features; best practice is to trigger
the dialog by invoking \f[CR]preventDefault()\f[R] on the event object,
while also setting \f[CR]returnValue\f[R] to support legacy cases.
.SH SYNTAX
Use the event name in methods like \f[CR]addEventListener()\f[R], or set
an event handler property.
.IP
.EX
addEventListener(\[dq]beforeunload\[dq], (event) \f[B]=>\f[R] {});
onbeforeunload = (event) \f[B]=>\f[R] {};
.EE
.SH EVENT TYPE
A \f[CR]BeforeUnloadEvent\f[R].
Inherits from \f[CR]Event\f[R].
.SH USAGE NOTES
To trigger the dialog being shown when the user closes or navigates the
tab, a \f[CR]beforeunload\f[R] event handler function should call
\f[CR]preventDefault()\f[R] on the event object.
You should note that modern implementations:
.IP \[bu] 2
Require sticky activation for the dialog to be displayed.
In other words, the browser will only show the dialog box if the frame
or any embedded frame receives a user gesture or user interaction.
If the user has never interacted with the page, then there is no user
data to save, so no legitimate use case for the dialog.
.IP \[bu] 2
Only show a generic browser\-specified string in the displayed dialog.
This cannot be controlled by the webpage code.
.PP
The \f[CR]beforeunload\f[R] event suffers from some problems:
.IP \[bu] 2
It is not reliably fired, especially on mobile platforms.
For example, the \f[CR]beforeunload\f[R] event is not fired at all in
the following scenario:
.RS 2
.IP "1." 3
A mobile user visits your page.
.IP "2." 3
The user then switches to a different app.
.IP "3." 3
Later, the user closes the browser from the app manager.
.RS
.PP
\f[B]Note:\f[R] It is recommended to use the \f[CR]visibilitychange\f[R]
event as a more reliable signal for automatic app state saving that gets
around problems like the above.
See \c
.UR https://www.igvita.com/2015/11/20/dont-lose-user-and-app-state-use-page-visibility/
Don\[cq]t lose user and app state, use Page Visibility
.UE \c
\ for more details.
.RE
.RE
.IP \[bu] 2
In Firefox, \f[CR]beforeunload\f[R] is not compatible with the \c
.UR https://web.dev/articles/bfcache
back/forward cache
.UE \c
\ (bfcache): that is, Firefox will not place pages in the bfcache if
they have \f[CR]beforeunload\f[R] listeners, and this is bad for
performance.
.PP
It is therefore recommended that developers listen for
\f[CR]beforeunload\f[R] only when users have unsaved changes so that the
dialog mentioned above can be used to warn them about impending data
loss, and remove the listener again when it is not needed.
Listening for \f[CR]beforeunload\f[R] sparingly can minimize the effect
on performance.
.SH EVENT HANDLER ALIASES
In addition to the \f[CR]Window\f[R] interface, the event handler
property \f[CR]onbeforeunload\f[R] is also available on the following
targets:
.IP \[bu] 2
\f[CR]HTMLBodyElement\f[R]
.IP \[bu] 2
\f[CR]HTMLFrameSetElement\f[R]
.IP \[bu] 2
\f[CR]SVGSVGElement\f[R]
.SH EXAMPLES
In the following example we have an HTML text \f[CR]<input>\f[R] to
represent some data that could be changed and require saving:
.IP
.EX
<\f[B]form\f[R]>
  <\f[B]input\f[R] type=\[dq]text\[dq] name=\[dq]name\[dq] id=\[dq]name\[dq] />
</\f[B]form\f[R]>
.EE
.PP
Our JavaScript attaches an \f[CR]input\f[R] event listener to the
\f[CR]<input>\f[R] element that listens for changes in the inputted
value.
When the value is updated to a non\-empty value, a
\f[CR]beforeunload\f[R] event listener is attached to the
\f[CR]Window\f[R] object.
.PP
If the value becomes an empty string again (i.e.\ the value is deleted),
the \f[CR]beforeunload\f[R] event listener is removed again \[em] as
mentioned above in the Usage notes, the listener should be removed when
there is no unsaved data to warn about.
.PP
The \f[CR]beforeunload\f[R] event handler function invokes
\f[CR]event.preventDefault()\f[R] to trigger the warning dialog when the
user closes or navigates the tab.
We have also included \f[CR]event.returnValue = true\f[R] in the handler
function so that any browsers that don\[cq]t support the
\f[CR]event.preventDefault()\f[R] mechanism will still run the demo
correctly.
.IP
.EX
\f[B]const\f[R] beforeUnloadHandler = (event) \f[B]=>\f[R] {
  \f[I]// Recommended\f[R]
  event.preventDefault();

  \f[I]// Included for legacy support, e.g. Chrome/Edge < 119\f[R]
  event.returnValue = \f[B]true\f[R];
};

\f[B]const\f[R] nameInput = document.querySelector(\[dq]#name\[dq]);

nameInput.addEventListener(\[dq]input\[dq], (event) \f[B]=>\f[R] {
  \f[B]if\f[R] (event.target.value !== \[dq]\[dq]) {
    window.addEventListener(\[dq]beforeunload\[dq], beforeUnloadHandler);
  } \f[B]else\f[R] {
    window.removeEventListener(\[dq]beforeunload\[dq], beforeUnloadHandler);
  }
});
.EE
.PP
When the \f[CR]<input>\f[R] value is non\-empty, if you try to close,
navigate, or reload the page the browser displays the warning dialog.
Try it out:
.SH SEE ALSO
.IP \[bu] 2
\f[CR]BeforeUnloadEvent\f[R] interface
.IP \[bu] 2
Related events:
.RS 2
.IP \[bu] 2
\f[CR]DOMContentLoaded\f[R]
.IP \[bu] 2
\f[CR]readystatechange\f[R]
.IP \[bu] 2
\f[CR]load\f[R]
.IP \[bu] 2
\f[CR]unload\f[R]
.RE
.IP \[bu] 2
\c
.UR https://developer.chrome.com/docs/web-platform/page-lifecycle-api#developer-recommendations-for-each-state
Page Lifecycle API
.UE \c
\ provides more useful guidance on handling page lifecycle behavior in
your web apps.
